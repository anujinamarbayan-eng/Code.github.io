<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Emergency Dosage</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background-color: #f0f2f5;
    margin: 0;
    min-height: 100vh;
    transition: background-color 0.5s ease;
}

/* Stress Levels */
.level-1 { background-color: #e1e8ed; }
.level-2 { background-color: #d1d8e0; }
.level-3 { background-color: #2c3e50; color: white; }
.level-max {
    background-color: #000;
    color: #ff0000;
    animation: shake 0.2s infinite;
}

    .game-card {
    background: rgba(255,255,255,0.95);
    padding: 40px;
    max-width: 420px;
    width: 100%;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    text-align: center;
    color: #333; /* <--- Add this line to keep text dark inside the card */
}

@keyframes shake {
    0% { transform: translate(1px, 1px); }
    25% { transform: translate(-1px, -2px); }
    50% { transform: translate(-3px, 1px); }
    100% { transform: translate(1px, -1px); }
}

.page-content {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.game-card {
    background: rgba(255,255,255,0.95);
    padding: 40px;
    max-width: 420px;
    width: 100%;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    text-align: center;
}

.level-max .game-card {
    background: rgba(20,20,20,0.9);
    color: white;
    border: 2px solid red;
}

.progress-container {
    background: #eee;
    border-radius: 10px;
    height: 10px;
    margin: 20px 0;
    overflow: hidden;
}

#progress-bar {
    height: 100%;
    width: 0%;
    background: #3498db;
    transition: width 0.4s ease;
}

input {
    width: 80%;
    padding: 12px;
    font-size: 1.2rem;
    text-align: center;
    border-radius: 8px;
    border: 2px solid #ccc;
}

button {
    margin-top: 15px;
    padding: 12px 25px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

.btn-submit { background: #3498db; color: white; }
.btn-reset { background: #95a5a6; color: white; }

#feedback {
    margin-top: 20px;
    min-height: 1.5em;
}
</style>
</head>

<body>

<div class="page-content">
<div class="game-card">

<h1 id="title">ðŸ§ª Emergency Dosage</h1>
<p id="scenario"></p>

<div class="progress-container">
    <div id="progress-bar"></div>
</div>

<input type="number" id="guessInput" placeholder="Enter grams">

<br>
<button class="btn-submit" onclick="submitDose()">Administer Dose</button>
<button class="btn-reset" onclick="resetGame()">Reset</button>

<p id="feedback">System Ready.</p>
<p id="attempts-text" style="font-size:0.85rem;">Attempts Used: 0 / 5</p>

</div>
</div>

<script>
let attempts = 0;
const maxAttempts = 5;

// Patient data
const medicine = "Amoxicillin";
const molarMass = 365.4;   // g/mol
const requiredMoles = 0.02;

const correctMass = molarMass * requiredMoles;

const input = document.getElementById("guessInput");

// Show scenario
document.getElementById("scenario").innerHTML =
`<strong>Medicine:</strong> ${medicine}<br>
<strong>Molar Mass:</strong> ${molarMass} g/mol<br>
<strong>Required Dose:</strong> ${requiredMoles} moles`;

input.addEventListener("keypress", function(e) {
    if (e.key === "Enter") submitDose();
});

function submitDose() {
    const answer = parseFloat(input.value);
    const feedback = document.getElementById("feedback");

    if (isNaN(answer)) {
        feedback.textContent = "âš ï¸ Invalid input.";
        return;
    }

    attempts++;
    updateUI();

    if (round(answer, 2) === round(correctMass, 2)) {
        feedback.textContent = "ðŸŽ‰ Correct dosage! Patient stabilized.";
        endGame(true);
    } else if (attempts >= maxAttempts) {
        feedback.innerHTML =
            `ðŸ’€ Incorrect dosage.<br>
             Correct dose was <strong>${round(correctMass, 2)} g</strong>.`;
        endGame(false);
    } else {
        feedback.textContent = "âŒ Incorrect dose. Patient condition worsening...";
    }

    input.value = "";
}

function updateUI() {
    const percent = (attempts / maxAttempts) * 100;
    document.getElementById("progress-bar").style.width = percent + "%";
    document.getElementById("attempts-text").textContent =
        `Attempts Used: ${attempts} / ${maxAttempts}`;

    if (attempts >= 4) {
        document.body.className = "level-max";
    } else if (attempts >= 3) {
        document.body.className = "level-3";
    } else if (attempts >= 2) {
        document.body.className = "level-2";
    } else {
        document.body.className = "level-1";
    }
}

function endGame(win) {
    input.disabled = true;
    document.querySelector(".btn-submit").disabled = true;
    document.getElementById("title").textContent =
        win ? "ðŸŸ¢ Patient Saved" : "ðŸ”´ Patient Lost";
}

function resetGame() {
    attempts = 0;
    document.body.className = "";
    input.disabled = false;
    document.querySelector(".btn-submit").disabled = false;
    document.getElementById("progress-bar").style.width = "0%";
    document.getElementById("feedback").textContent = "System Ready.";
    document.getElementById("attempts-text").textContent = "Attempts Used: 0 / 5";
    document.getElementById("title").textContent = "ðŸ§ª Emergency Dosage";
}

function round(num, decimals) {
    return Math.round(num * Math.pow(10, decimals)) / Math.pow(10, decimals);
}
</script>

</body>
</html>
